<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Renault Preislisten-Tool</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.9/babel.min.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
      color: #e2e8f0;
      min-height: 100vh;
    }
    @keyframes spin { to { transform: rotate(360deg); } }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }
    input:focus, button:focus { outline: none; }
    input[type=number]::-webkit-inner-spin-button { -webkit-appearance: none; }
    input[type=number] { -moz-appearance: textfield; }
    ::-webkit-scrollbar { width: 6px; height: 6px; }
    ::-webkit-scrollbar-track { background: #1e293b; }
    ::-webkit-scrollbar-thumb { background: #475569; border-radius: 3px; }
    ::-webkit-scrollbar-thumb:hover { background: #64748b; }
    .toggle-track {
      width: 36px; height: 20px; border-radius: 10px; position: relative; cursor: pointer;
      transition: background 0.2s; display: inline-block; vertical-align: middle;
    }
    .toggle-track.on { background: #10b981; }
    .toggle-track.off { background: #475569; }
    .toggle-thumb {
      width: 16px; height: 16px; border-radius: 50%; background: white; position: absolute;
      top: 2px; transition: left 0.2s;
    }
    .toggle-track.on .toggle-thumb { left: 18px; }
    .toggle-track.off .toggle-thumb { left: 2px; }
    .year-sel {
      display: inline-flex; align-items: center; gap: 6px; padding: 5px 14px;
      border-radius: 8px; cursor: pointer; transition: all 0.2s; border: 2px solid transparent;
      user-select: none;
    }
    .year-sel.active { border-color: #f59e0b; background: rgba(245,158,11,0.1); }
    .year-sel.inactive { border-color: #334155; background: rgba(30,41,59,0.4); opacity: 0.6; }
    .year-sel:hover { opacity: 1; }
    .rdot {
      width: 16px; height: 16px; border-radius: 50%; border: 2px solid #475569;
      display: flex; align-items: center; justify-content: center; transition: all 0.2s;
    }
    .rdot.checked { border-color: #f59e0b; }
    .rdot.checked::after { content: ""; width: 8px; height: 8px; border-radius: 50%; background: #f59e0b; }
    .cell-e {
      cursor: pointer; padding: 2px 5px; border-radius: 4px; font-variant-numeric: tabular-nums;
      transition: all 0.15s; border: 1px dashed transparent; display: inline-block;
    }
    .cell-e:hover { background: rgba(255,255,255,0.06); border-color: #475569; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useRef, useMemo, useCallback } = React;

    // Login credentials
    const AUTH_USER = "oe";
    const AUTH_PASS = "deals!!@1234#";
    const AUTH_KEY = "renault-auth";

    const YEARS = [2025, 2026, 2027];
    const DLNR = "7455";
    const SK = "renault-pl-v6";

    const DEFAULTS = {
      "002E":{2025:{vk:0,ek:66},2026:{vk:0,ek:67.4},2027:{vk:0,ek:67.4},sonder:{vk:0,ek:0,active:false}},
      "002K":{2025:{vk:5,ek:55},2026:{vk:0,ek:0},2027:{vk:5,ek:0},sonder:{vk:5,ek:0,active:false}},
      "002M":{2025:{vk:62,ek:66},2026:{vk:0,ek:0},2027:{vk:62,ek:0},sonder:{vk:62,ek:0,active:false}},
      "027E":{2025:{vk:49,ek:53},2026:{vk:49,ek:54.6},2027:{vk:49,ek:54.6},sonder:{vk:49,ek:0,active:false}},
      "027K":{2025:{vk:5,ek:43},2026:{vk:0,ek:0},2027:{vk:5,ek:0},sonder:{vk:5,ek:0,active:false}},
      "033K":{2025:{vk:5,ek:63},2026:{vk:0,ek:0},2027:{vk:5,ek:0},sonder:{vk:5,ek:0,active:false}},
      "034K":{2025:{vk:5,ek:63},2026:{vk:0,ek:0},2027:{vk:5,ek:0},sonder:{vk:5,ek:0,active:false}},
      "035K":{2025:{vk:5,ek:63},2026:{vk:0,ek:0},2027:{vk:5,ek:0},sonder:{vk:5,ek:0,active:false}},
      "042K":{2025:{vk:5,ek:59},2026:{vk:0,ek:0},2027:{vk:5,ek:0},sonder:{vk:5,ek:0,active:false}},
      "060K":{2025:{vk:5,ek:51},2026:{vk:0,ek:0},2027:{vk:5,ek:0},sonder:{vk:5,ek:0,active:false}},
      "111U":{2025:{vk:53,ek:57},2026:{vk:53,ek:54.6},2027:{vk:53,ek:54.6},sonder:{vk:53,ek:0,active:false}},
      "112K":{2025:{vk:5,ek:21},2026:{vk:0,ek:0},2027:{vk:5,ek:0},sonder:{vk:5,ek:0,active:false}},
      "114K":{2025:{vk:5,ek:63},2026:{vk:0,ek:0},2027:{vk:5,ek:0},sonder:{vk:5,ek:0,active:false}},
      "114U":{2025:{vk:64,ek:69},2026:{vk:64,ek:68.2},2027:{vk:64,ek:68.2},sonder:{vk:64,ek:0,active:false}},
      "116U":{2025:{vk:55,ek:59.2},2026:{vk:55,ek:61.5},2027:{vk:55,ek:61.5},sonder:{vk:55,ek:0,active:false}},
      "126C":{2025:{vk:18.3,ek:26.5},2026:{vk:18.3,ek:27.9},2027:{vk:18.3,ek:27.9},sonder:{vk:18.3,ek:0,active:false}},
      "135U":{2025:{vk:55.6,ek:59.7},2026:{vk:55.6,ek:61.3},2027:{vk:55.6,ek:61.3},sonder:{vk:55.6,ek:0,active:false}},
      "139K":{2025:{vk:5,ek:51},2026:{vk:0,ek:0},2027:{vk:5,ek:0},sonder:{vk:5,ek:0,active:false}},
      "147C":{2025:{vk:52.1,ek:60.3},2026:{vk:52.1,ek:60.4},2027:{vk:52.1,ek:60.4},sonder:{vk:52.1,ek:0,active:false}},
      "150M":{2025:{vk:22.2,ek:26.5},2026:{vk:22.2,ek:32},2027:{vk:22.2,ek:32},sonder:{vk:22.2,ek:0,active:false}},
      "151E":{2025:{vk:53,ek:57},2026:{vk:53,ek:58},2027:{vk:53,ek:58},sonder:{vk:53,ek:0,active:false}},
      "197K":{2025:{vk:5,ek:43},2026:{vk:0,ek:0},2027:{vk:5,ek:0},sonder:{vk:5,ek:0,active:false}},
      "200C":{2025:{vk:48.8,ek:56.9},2026:{vk:48.8,ek:57.1},2027:{vk:48.8,ek:57.1},sonder:{vk:48.8,ek:0,active:false}},
      "201C":{2025:{vk:45.3,ek:53.5},2026:{vk:45.3,ek:53.8},2027:{vk:45.3,ek:53.8},sonder:{vk:45.3,ek:0,active:false}},
      "203C":{2025:{vk:48.8,ek:56.9},2026:{vk:48.8,ek:57.1},2027:{vk:48.8,ek:57.1},sonder:{vk:48.8,ek:0,active:false}},
      "204C":{2025:{vk:48.1,ek:56.3},2026:{vk:48.1,ek:59.1},2027:{vk:48.1,ek:59.1},sonder:{vk:48.1,ek:0,active:false}},
      "226C":{2025:{vk:18.1,ek:26.5},2026:{vk:18.1,ek:26.5},2027:{vk:18.1,ek:26.5},sonder:{vk:18.1,ek:0,active:false}},
      "231C":{2025:{vk:33.6,ek:41.8},2026:{vk:0,ek:0},2027:{vk:33.6,ek:0},sonder:{vk:33.6,ek:0,active:false}},
      "271M":{2025:{vk:47,ek:53},2026:{vk:47,ek:43},2027:{vk:47,ek:43},sonder:{vk:47,ek:0,active:false}},
      "282C":{2025:{vk:48.8,ek:56.9},2026:{vk:48.8,ek:57.1},2027:{vk:48.8,ek:57.1},sonder:{vk:48.8,ek:0,active:false}},
      "283C":{2025:{vk:18.3,ek:26.5},2026:{vk:0,ek:0},2027:{vk:18.3,ek:0},sonder:{vk:18.3,ek:0,active:false}},
      "284C":{2025:{vk:48.85,ek:56.9},2026:{vk:48.85,ek:57.1},2027:{vk:48.85,ek:57.1},sonder:{vk:48.85,ek:0,active:false}},
      "289C":{2025:{vk:33.6,ek:41.8},2026:{vk:33.6,ek:50.2},2027:{vk:33.6,ek:50.2},sonder:{vk:33.6,ek:0,active:false}},
      "338C":{2025:{vk:18.3,ek:26.5},2026:{vk:18.3,ek:27.6},2027:{vk:18.3,ek:27.6},sonder:{vk:18.3,ek:0,active:false}},
      "341C":{2025:{vk:18.3,ek:26.5},2026:{vk:18.3,ek:27.6},2027:{vk:18.3,ek:27.6},sonder:{vk:18.3,ek:0,active:false}},
      "346C":{2025:{vk:18.3,ek:26.5},2026:{vk:18.3,ek:29.9},2027:{vk:18.3,ek:29.9},sonder:{vk:18.3,ek:0,active:false}},
      "352E":{2025:{vk:55.6,ek:60.7},2026:{vk:55.6,ek:63.5},2027:{vk:55.6,ek:63.5},sonder:{vk:55.6,ek:0,active:false}},
      "352K":{2025:{vk:5,ek:59},2026:{vk:0,ek:0},2027:{vk:5,ek:0},sonder:{vk:5,ek:0,active:false}},
      "384K":{2025:{vk:5,ek:51},2026:{vk:0,ek:0},2027:{vk:5,ek:0},sonder:{vk:5,ek:0,active:false}},
      "416C":{2025:{vk:18.3,ek:26.5},2026:{vk:18.3,ek:32},2027:{vk:18.3,ek:32},sonder:{vk:18.3,ek:0,active:false}},
      "471C":{2025:{vk:18.3,ek:26.5},2026:{vk:18.3,ek:27.9},2027:{vk:18.3,ek:27.9},sonder:{vk:18.3,ek:0,active:false}},
      "481E":{2025:{vk:58.6,ek:62.8},2026:{vk:58.6,ek:64.9},2027:{vk:58.6,ek:64.9},sonder:{vk:58.6,ek:0,active:false}},
      "501E":{2025:{vk:62,ek:66},2026:{vk:62,ek:65.8},2027:{vk:62,ek:65.8},sonder:{vk:62,ek:0,active:false}},
      "501K":{2025:{vk:5,ek:59},2026:{vk:0,ek:0},2027:{vk:5,ek:0},sonder:{vk:5,ek:0,active:false}},
      "502E":{2025:{vk:60,ek:64},2026:{vk:60,ek:68.2},2027:{vk:60,ek:68.2},sonder:{vk:60,ek:0,active:false}},
      "502K":{2025:{vk:5,ek:59},2026:{vk:0,ek:0},2027:{vk:5,ek:0},sonder:{vk:5,ek:0,active:false}},
      "503E":{2025:{vk:56,ek:60},2026:{vk:56,ek:64.8},2027:{vk:56,ek:64.8},sonder:{vk:56,ek:0,active:false}},
      "503K":{2025:{vk:5,ek:51},2026:{vk:0,ek:0},2027:{vk:5,ek:0},sonder:{vk:5,ek:0,active:false}},
      "507E":{2025:{vk:5,ek:68},2026:{vk:0,ek:0},2027:{vk:5,ek:0},sonder:{vk:5,ek:0,active:false}},
      "507K":{2025:{vk:5,ek:51},2026:{vk:0,ek:0},2027:{vk:5,ek:0},sonder:{vk:5,ek:0,active:false}},
      "510M":{2025:{vk:45,ek:51},2026:{vk:45,ek:50.7},2027:{vk:45,ek:50.7},sonder:{vk:45,ek:0,active:false}},
      "513E":{2025:{vk:61.6,ek:65.7},2026:{vk:61.6,ek:67.7},2027:{vk:61.6,ek:67.7},sonder:{vk:61.6,ek:0,active:false}},
      "520E":{2025:{vk:64,ek:68.1},2026:{vk:64,ek:72.9},2027:{vk:64,ek:72.9},sonder:{vk:64,ek:0,active:false}},
      "520K":{2025:{vk:5,ek:59},2026:{vk:0,ek:0},2027:{vk:5,ek:0},sonder:{vk:5,ek:0,active:false}},
      "532K":{2025:{vk:5,ek:59},2026:{vk:0,ek:0},2027:{vk:5,ek:0},sonder:{vk:5,ek:0,active:false}},
      "541K":{2025:{vk:5,ek:51},2026:{vk:0,ek:0},2027:{vk:5,ek:0},sonder:{vk:5,ek:0,active:false}},
      "545K":{2025:{vk:5,ek:51},2026:{vk:0,ek:0},2027:{vk:5,ek:0},sonder:{vk:5,ek:0,active:false}},
      "553C":{2025:{vk:18.3,ek:26.5},2026:{vk:18.3,ek:36},2027:{vk:18.3,ek:36},sonder:{vk:18.3,ek:0,active:false}},
      "554E":{2025:{vk:56.6,ek:60.7},2026:{vk:56.6,ek:61.1},2027:{vk:56.6,ek:61.1},sonder:{vk:56.6,ek:0,active:false}},
      "554K":{2025:{vk:5,ek:55},2026:{vk:0,ek:0},2027:{vk:5,ek:0},sonder:{vk:5,ek:0,active:false}},
      "559M":{2025:{vk:42,ek:48},2026:{vk:42,ek:48.2},2027:{vk:42,ek:48.2},sonder:{vk:42,ek:0,active:false}},
      "565M":{2025:{vk:55,ek:59.3},2026:{vk:55,ek:60.8},2027:{vk:55,ek:60.8},sonder:{vk:55,ek:0,active:false}},
      "573M":{2025:{vk:42,ek:48},2026:{vk:42,ek:48.2},2027:{vk:42,ek:48.2},sonder:{vk:42,ek:0,active:false}},
      "576U":{2025:{vk:48,ek:54},2026:{vk:48,ek:53.9},2027:{vk:48,ek:53.9},sonder:{vk:48,ek:0,active:false}},
      "581E":{2025:{vk:64,ek:68.1},2026:{vk:64,ek:70.5},2027:{vk:64,ek:70.5},sonder:{vk:64,ek:0,active:false}},
      "581K":{2025:{vk:5,ek:59},2026:{vk:0,ek:0},2027:{vk:5,ek:0},sonder:{vk:5,ek:0,active:false}},
      "591C":{2025:{vk:30,ek:38.4},2026:{vk:30,ek:43.7},2027:{vk:30,ek:43.7},sonder:{vk:30,ek:0,active:false}},
      "601K":{2025:{vk:5,ek:59},2026:{vk:0,ek:0},2027:{vk:5,ek:0},sonder:{vk:5,ek:0,active:false}},
      "601U":{2025:{vk:62,ek:66},2026:{vk:62,ek:59.3},2027:{vk:62,ek:59.3},sonder:{vk:62,ek:0,active:false}},
      "616C":{2025:{vk:48.8,ek:57},2026:{vk:48.8,ek:60.8},2027:{vk:48.8,ek:60.8},sonder:{vk:48.8,ek:0,active:false}},
      "631K":{2025:{vk:5,ek:43},2026:{vk:0,ek:0},2027:{vk:5,ek:0},sonder:{vk:5,ek:0,active:false}},
      "631U":{2025:{vk:48.6,ek:52.8},2026:{vk:48.6,ek:54.6},2027:{vk:48.6,ek:54.6},sonder:{vk:48.6,ek:0,active:false}},
      "632C":{2025:{vk:47,ek:55.4},2026:{vk:47,ek:59.1},2027:{vk:47,ek:59.1},sonder:{vk:47,ek:0,active:false}},
      "633C":{2025:{vk:47,ek:55.4},2026:{vk:47,ek:59.1},2027:{vk:47,ek:59.1},sonder:{vk:47,ek:0,active:false}},
      "634C":{2025:{vk:53,ek:61},2026:{vk:53,ek:61.7},2027:{vk:53,ek:61.7},sonder:{vk:53,ek:0,active:false}},
      "635K":{2025:{vk:5,ek:59},2026:{vk:0,ek:0},2027:{vk:5,ek:0},sonder:{vk:5,ek:0,active:false}},
      "642M":{2025:{vk:40,ek:46},2026:{vk:40,ek:45},2027:{vk:40,ek:45},sonder:{vk:40,ek:0,active:false}},
      "646C":{2025:{vk:39.6,ek:47.7},2026:{vk:39.6,ek:53},2027:{vk:39.6,ek:53},sonder:{vk:39.6,ek:0,active:false}},
      "651C":{2025:{vk:30,ek:38.4},2026:{vk:30,ek:43.7},2027:{vk:30,ek:43.7},sonder:{vk:30,ek:0,active:false}},
      "658E":{2025:{vk:69,ek:73},2026:{vk:69,ek:72.9},2027:{vk:69,ek:72.9},sonder:{vk:69,ek:0,active:false}},
      "658K":{2025:{vk:5,ek:59},2026:{vk:0,ek:0},2027:{vk:5,ek:0},sonder:{vk:5,ek:0,active:false}},
      "673K":{2025:{vk:5,ek:51},2026:{vk:0,ek:0},2027:{vk:5,ek:0},sonder:{vk:5,ek:0,active:false}},
      "674E":{2025:{vk:61.6,ek:65.6},2026:{vk:61.6,ek:72.9},2027:{vk:61.6,ek:72.9},sonder:{vk:61.6,ek:0,active:false}},
      "674K":{2025:{vk:5,ek:59},2026:{vk:0,ek:0},2027:{vk:5,ek:0},sonder:{vk:5,ek:0,active:false}},
      "696M":{2025:{vk:18,ek:22.2},2026:{vk:18,ek:27.8},2027:{vk:18,ek:27.8},sonder:{vk:18,ek:0,active:false}},
      "802K":{2025:{vk:5,ek:21},2026:{vk:0,ek:0},2027:{vk:5,ek:0},sonder:{vk:5,ek:0,active:false}},
      "803K":{2025:{vk:5,ek:63},2026:{vk:0,ek:0},2027:{vk:5,ek:0},sonder:{vk:5,ek:0,active:false}},
      "803U":{2025:{vk:64.6,ek:68.8},2026:{vk:64.6,ek:69.4},2027:{vk:64.6,ek:69.4},sonder:{vk:64.6,ek:0,active:false}},
      "804K":{2025:{vk:5,ek:59},2026:{vk:0,ek:0},2027:{vk:5,ek:0},sonder:{vk:5,ek:0,active:false}},
      "807K":{2025:{vk:5,ek:59},2026:{vk:0,ek:0},2027:{vk:5,ek:0},sonder:{vk:5,ek:0,active:false}},
      "807U":{2025:{vk:65.7,ek:69.9},2026:{vk:65.7,ek:70.2},2027:{vk:65.7,ek:70.2},sonder:{vk:65.7,ek:0,active:false}},
      "811U":{2025:{vk:37.4,ek:41.5},2026:{vk:37.4,ek:43.1},2027:{vk:37.4,ek:43.1},sonder:{vk:37.4,ek:0,active:false}},
      "812K":{2025:{vk:5,ek:63},2026:{vk:0,ek:0},2027:{vk:5,ek:0},sonder:{vk:5,ek:0,active:false}},
      "812U":{2025:{vk:60,ek:64},2026:{vk:60,ek:63.8},2027:{vk:60,ek:63.8},sonder:{vk:60,ek:0,active:false}},
      "819K":{2025:{vk:5,ek:21},2026:{vk:0,ek:0},2027:{vk:5,ek:0},sonder:{vk:5,ek:0,active:false}},
      "820K":{2025:{vk:5,ek:55},2026:{vk:0,ek:0},2027:{vk:5,ek:0},sonder:{vk:5,ek:0,active:false}},
      "820U":{2025:{vk:55.8,ek:59.9},2026:{vk:55.8,ek:62.1},2027:{vk:55.8,ek:62.1},sonder:{vk:55.8,ek:0,active:false}},
      "823K":{2025:{vk:5,ek:51},2026:{vk:0,ek:0},2027:{vk:5,ek:0},sonder:{vk:5,ek:0,active:false}},
      "835K":{2025:{vk:5,ek:51},2026:{vk:0,ek:0},2027:{vk:5,ek:0},sonder:{vk:5,ek:0,active:false}},
      "861C":{2025:{vk:51,ek:59.3},2026:{vk:51,ek:60.8},2027:{vk:51,ek:60.8},sonder:{vk:51,ek:0,active:false}},
      "864C":{2025:{vk:49,ek:57.4},2026:{vk:49,ek:58.7},2027:{vk:49,ek:58.7},sonder:{vk:49,ek:0,active:false}},
      "871C":{2025:{vk:32.7,ek:39.8},2026:{vk:32.7,ek:39.8},2027:{vk:32.7,ek:39.8},sonder:{vk:32.7,ek:0,active:false}},
      "883K":{2025:{vk:5,ek:40},2026:{vk:0,ek:0},2027:{vk:5,ek:0},sonder:{vk:5,ek:0,active:false}},
      "890C":{2025:{vk:22.6,ek:30.6},2026:{vk:22.6,ek:32},2027:{vk:22.6,ek:32},sonder:{vk:22.6,ek:0,active:false}},
      "892K":{2025:{vk:5,ek:51},2026:{vk:0,ek:0},2027:{vk:5,ek:0},sonder:{vk:5,ek:0,active:false}},
      "901C":{2025:{vk:53,ek:60},2026:{vk:53,ek:60.4},2027:{vk:53,ek:60.4},sonder:{vk:53,ek:0,active:false}},
      "918M":{2025:{vk:45,ek:51},2026:{vk:45,ek:52.2},2027:{vk:45,ek:52.2},sonder:{vk:45,ek:0,active:false}},
      "925C":{2025:{vk:26.7,ek:34.8},2026:{vk:26.7,ek:27.9},2027:{vk:26.7,ek:27.9},sonder:{vk:26.7,ek:0,active:false}},
      "948K":{2025:{vk:5,ek:66},2026:{vk:0,ek:0},2027:{vk:5,ek:0},sonder:{vk:5,ek:0,active:false}},
      "960K":{2025:{vk:5,ek:51},2026:{vk:0,ek:0},2027:{vk:5,ek:0},sonder:{vk:5,ek:0,active:false}},
      "961K":{2025:{vk:5,ek:51},2026:{vk:0,ek:0},2027:{vk:5,ek:0},sonder:{vk:5,ek:0,active:false}},
      "977K":{2025:{vk:5,ek:55},2026:{vk:0,ek:0},2027:{vk:5,ek:0},sonder:{vk:5,ek:0,active:false}}
    };

    function mkDefault() {
      const fam = {};
      for (const [c, d] of Object.entries(DEFAULTS)) {
        fam[c] = {
          2025: d[2025],
          2026: d[2026],
          2027: d[2027],
          sonder: d.sonder
        };
      }
      return { activeYear: 2026, families: fam };
    }

    function load() {
      try {
        const s = localStorage.getItem(SK);
        if (s) {
          const p = JSON.parse(s);
          for (const c of Object.keys(p.families)) {
            const f = p.families[c];
            for (const y of YEARS) if (!f[y]) f[y] = {vk:0,ek:0};
            if (!f.sonder) f.sonder = {vk:0,ek:0,active:false};
          }
          if (!p.activeYear || p.activeYear === 2025) p.activeYear = 2026;
          return p;
        }
      } catch(e) {}
      return mkDefault();
    }

    function save(st) { try { localStorage.setItem(SK, JSON.stringify(st)); } catch(e) {} }

    function rnd(v) { return Math.round(v * 100 + Number.EPSILON) / 100; }

    function getDisc(fam, yr) {
      if (fam.sonder && fam.sonder.active && (fam.sonder.vk > 0 || fam.sonder.ek > 0))
        return { vk: fam.sonder.vk, ek: fam.sonder.ek, src: "Sonder" };
      const yd = fam[yr];
      if (yd && (yd.vk > 0 || yd.ek > 0)) return { vk: yd.vk, ek: yd.ek, src: String(yr) };
      return null;
    }

    function processCSV(csv, families, yr) {
      const lines = csv.split(/\r?\n/).filter(l => l.trim());
      const dL = [], eL = [];
      let ok = 0, skip = 0, noD = 0;
      for (const line of lines) {
        const c = line.split(";");
        if (c.length < 23) continue;
        const art = c[6].trim(), desc = c[9].trim();
        const lp = parseInt(c[11],10) / 100;
        const w = parseInt(c[19],10);
        const fc = c[21].trim() + c[22].trim();
        const fam = families[fc];
        if (!fam) { skip++; continue; }
        const d = getDisc(fam, yr);
        if (!d) { noD++; continue; }
        const bC = rnd(lp * (100 - d.vk) / 100);
        const bS = rnd(lp * (100 - d.ek) / 100);
        dL.push(`${art};${lp.toFixed(2)};${bC.toFixed(2)}`);
        eL.push(`${art};${lp.toFixed(2)};${bC.toFixed(2)};${bS.toFixed(2)};${d.vk};${d.ek};${desc};${w};${DLNR}`);
        ok++;
      }
      return {
        defCSV: "article;list_price;buying_price\n" + dL.join("\n"),
        extCSV: "article;list_price;buying_price;buying_price_self;discount;discount_self;description;weight;DLNR\n" + eL.join("\n"),
        ok, skip, noD, total: lines.length
      };
    }

    function dl(content, fn) {
      const a = document.createElement("a");
      a.href = URL.createObjectURL(new Blob([content], {type:"text/csv;charset=utf-8;"}));
      a.download = fn; a.click();
    }

    function Toggle({on, onToggle}) {
      return <div className={`toggle-track ${on?"on":"off"}`} onClick={onToggle}><div className="toggle-thumb"/></div>;
    }

    function App() {
      const [state, setState] = useState(load);
      const [tab, setTab] = useState("upload");
      const [result, setResult] = useState(null);
      const [drag, setDrag] = useState(false);
      const [busy, setBusy] = useState(false);
      const [search, setSearch] = useState("");
      const [nCode, setNCode] = useState("");
      const [msg, setMsg] = useState("");
      const [eCell, setECell] = useState(null);
      const [eVal, setEVal] = useState("");
      const fRef = useRef(null);

      const { families, activeYear } = state;

      const upd = useCallback((ns) => {
        setState(ns); save(ns);
        setMsg("‚úì Gespeichert"); setTimeout(() => setMsg(""), 2000);
      }, []);

      const setYear = y => upd({...state, activeYear: y});

      const setField = (code, grp, field, val) => {
        const nf = {...families, [code]: {...families[code], [grp]: {...families[code][grp], [field]: val}}};
        upd({...state, families: nf});
      };

      const togSonder = code => {
        const f = families[code];
        const nf = {...families, [code]: {...f, sonder: {...f.sonder, active: !f.sonder.active}}};
        upd({...state, families: nf});
      };

      const addFam = () => {
        const c = nCode.trim().toUpperCase();
        if (!c || families[c]) return;
        upd({...state, families: {...families, [c]: {2025:{vk:0,ek:0},2026:{vk:0,ek:0},2027:{vk:0,ek:0},sonder:{vk:0,ek:0,active:false}}}});
        setNCode("");
      };

      const delFam = c => { const nf = {...families}; delete nf[c]; upd({...state, families: nf}); };

      const doFile = useCallback(async f => {
        if (!f) return; setBusy(true); setResult(null);
        try { setResult(processCSV(await f.text(), families, activeYear)); }
        catch(e) { setResult({error: e.message}); }
        setBusy(false);
      }, [families, activeYear]);

      const startE = (k, v) => { setECell(k); setEVal(String(v||0)); };
      const commitE = (code, grp, field) => {
        const v = parseFloat(eVal);
        if (!isNaN(v)) setField(code, grp, field, v);
        setECell(null); setEVal("");
      };

      const filtered = useMemo(() => {
        const e = Object.entries(families);
        return search ? e.filter(([c]) => c.toLowerCase().includes(search.toLowerCase())) : e;
      }, [families, search]);

      const cnt = Object.keys(families).length;
      const tC = {U:{bg:"#1e3a5f",t:"#60a5fa"},C:{bg:"#3b1f0b",t:"#fdba74"},K:{bg:"#1a2e1a",t:"#86efac"},M:{bg:"#3b1f3b",t:"#d8b4fe"},E:{bg:"#3b3b0b",t:"#fde047"}};
      const yC = {2025:"#94a3b8",2026:"#60a5fa",2027:"#34d399"};

      const renderE = (code, grp, field, val, color) => {
        const k = `${code}-${grp}-${field}`;
        if (eCell === k) return (
          <input autoFocus type="number" step="0.01" value={eVal}
            onChange={e => setEVal(e.target.value)}
            onBlur={() => commitE(code,grp,field)}
            onKeyDown={e => {if(e.key==="Enter")commitE(code,grp,field);if(e.key==="Escape"){setECell(null);setEVal("");}}}
            style={{background:"#0f172a",border:`1px solid ${color}`,borderRadius:4,padding:"2px 5px",color:"#e2e8f0",fontSize:12,width:65,textAlign:"right"}} />
        );
        const empty = !val || val === 0;
        return (
          <span className="cell-e" onClick={() => startE(k, val)}
            style={{color: empty ? "#334155" : color, fontSize:12}}
            title="Klicken zum Bearbeiten">
            {empty ? "‚Äî" : val}
          </span>
        );
      };

      return (
        <div>
          {/* Header */}
          <div style={{background:"rgba(15,23,42,0.92)",backdropFilter:"blur(12px)",borderBottom:"1px solid #1e293b",padding:"10px 20px",position:"sticky",top:0,zIndex:50}}>
            <div style={{maxWidth:1600,margin:"0 auto",display:"flex",alignItems:"center",justifyContent:"space-between",flexWrap:"wrap",gap:10}}>
              <div style={{display:"flex",alignItems:"center",gap:10}}>
                <div style={{background:"linear-gradient(135deg,#f59e0b,#d97706)",borderRadius:10,width:36,height:36,display:"flex",alignItems:"center",justifyContent:"center",fontWeight:800,fontSize:16,color:"#0f172a"}}>R</div>
                <div>
                  <h1 style={{fontSize:16,fontWeight:700,color:"#f8fafc"}}>Renault Preislisten-Tool</h1>
                  <p style={{fontSize:11,color:"#64748b"}}>Rabatte vergleichen & Preislisten generieren</p>
                </div>
              </div>

              <div style={{display:"flex",alignItems:"center",gap:6,flexWrap:"wrap"}}>
                <span style={{fontSize:11,color:"#64748b",marginRight:2}}>Kalkulation:</span>
                <div style={{padding:"5px 14px",borderRadius:8,border:"2px solid #334155",background:"rgba(30,41,59,0.4)",opacity:0.5,display:"inline-flex",alignItems:"center",gap:6,cursor:"not-allowed"}}>
                  <span style={{fontSize:12,color:"#475569"}}>üîí</span>
                  <span style={{fontWeight:600,fontSize:13,color:"#475569"}}>2025</span>
                  <span style={{fontSize:9,color:"#475569"}}>(Referenz)</span>
                </div>
                {[2026,2027].map(y => (
                  <div key={y} className={`year-sel ${activeYear===y?"active":"inactive"}`} onClick={() => setYear(y)}>
                    <div className={`rdot ${activeYear===y?"checked":""}`}/>
                    <span style={{fontWeight:600,fontSize:13,color:activeYear===y?"#f59e0b":"#64748b"}}>{y}</span>
                  </div>
                ))}
                <span style={{fontSize:11,color:"#475569",marginLeft:4}}>+ Sonder</span>
              </div>

              <div style={{display:"flex",gap:3,background:"#1e293b",borderRadius:8,padding:3}}>
                {[{id:"upload",l:"üìÑ Preisliste"},{id:"admin",l:"‚öôÔ∏è Rabatte"}].map(t => (
                  <button key={t.id} onClick={() => setTab(t.id)} style={{
                    padding:"7px 18px",borderRadius:7,border:"none",cursor:"pointer",fontSize:13,fontWeight:500,
                    background:tab===t.id?"linear-gradient(135deg,#f59e0b,#d97706)":"transparent",
                    color:tab===t.id?"#0f172a":"#94a3b8"
                  }}>{t.l}</button>
                ))}
              </div>
            </div>
          </div>

          <div style={{maxWidth:1600,margin:"0 auto",padding:"20px"}}>

            {/* UPLOAD */}
            {tab==="upload" && (
              <div style={{maxWidth:900,margin:"0 auto",animation:"fadeIn 0.3s ease"}}>
                <div style={{display:"grid",gridTemplateColumns:"repeat(auto-fit,minmax(160px,1fr))",gap:10,marginBottom:20}}>
                  {[{l:"Kalkulation",v:activeYear,c:"#f59e0b"},{l:"Familien",v:cnt,c:"#3b82f6"},{l:"DLNR",v:DLNR,c:"#10b981"}].map((s,i) => (
                    <div key={i} style={{background:"rgba(30,41,59,0.6)",border:"1px solid #334155",borderRadius:10,padding:"14px 18px"}}>
                      <p style={{fontSize:10,color:"#64748b",textTransform:"uppercase",letterSpacing:1,marginBottom:3}}>{s.l}</p>
                      <p style={{fontSize:22,fontWeight:700,color:s.c}}>{s.v}</p>
                    </div>
                  ))}
                </div>

                <div style={{background:"rgba(59,130,246,0.08)",border:"1px solid rgba(59,130,246,0.2)",borderRadius:8,padding:"8px 14px",marginBottom:16,fontSize:12,color:"#93c5fd"}}>
                  ‚ÑπÔ∏è Kalkulation nutzt <strong>{activeYear}</strong>. Familien mit aktiven <strong>Sonderrabatten</strong> werden bevorzugt.
                </div>

                <div onDragOver={e=>{e.preventDefault();setDrag(true);}} onDragLeave={()=>setDrag(false)}
                  onDrop={e=>{e.preventDefault();setDrag(false);doFile(e.dataTransfer.files[0]);}}
                  onClick={()=>fRef.current?.click()}
                  style={{border:`2px dashed ${drag?"#f59e0b":"#334155"}`,borderRadius:14,padding:"50px 24px",textAlign:"center",cursor:"pointer",
                    background:drag?"rgba(245,158,11,0.05)":"rgba(30,41,59,0.3)",marginBottom:20,transition:"all 0.3s"}}>
                  <input ref={fRef} type="file" style={{display:"none"}} onChange={e=>doFile(e.target.files[0])} />
                  <div style={{fontSize:44,marginBottom:10}}>{busy?"‚è≥":"üìÅ"}</div>
                  <p style={{fontSize:16,fontWeight:600,marginBottom:4}}>{busy?"Verarbeite...":"Renault Preisdatei hier ablegen"}</p>
                  <p style={{fontSize:13,color:"#64748b"}}>CSV oder TLDRAGP-Datei ‚Ä¢ Drag & Drop oder klicken</p>
                </div>

                {busy && <div style={{textAlign:"center",marginBottom:20}}>
                  <div style={{width:32,height:32,border:"3px solid #334155",borderTop:"3px solid #f59e0b",borderRadius:"50%",animation:"spin 1s linear infinite",margin:"0 auto"}}/>
                </div>}

                {result && !result.error && (
                  <div style={{background:"rgba(30,41,59,0.6)",border:"1px solid #334155",borderRadius:14,padding:24,animation:"fadeIn 0.4s"}}>
                    <div style={{display:"flex",alignItems:"center",gap:10,marginBottom:16}}>
                      <span style={{fontSize:24}}>‚úÖ</span>
                      <div>
                        <h3 style={{fontSize:16,fontWeight:600}}>Preislisten erstellt!</h3>
                        <p style={{fontSize:12,color:"#64748b"}}>{result.ok.toLocaleString()} verarbeitet ‚Ä¢ {result.skip.toLocaleString()} ohne Familie ‚Ä¢ {result.noD.toLocaleString()} ohne Rabatt</p>
                      </div>
                    </div>
                    <div style={{background:"#1e293b",borderRadius:6,height:5,marginBottom:16,overflow:"hidden"}}>
                      <div style={{background:"linear-gradient(90deg,#10b981,#059669)",height:"100%",width:`${(result.ok/result.total)*100}%`,borderRadius:6}}/>
                    </div>
                    <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12}}>
                      <div style={{background:"#1e293b",borderRadius:10,padding:18,border:"1px solid #334155"}}>
                        <span style={{background:"#1e40af",borderRadius:5,padding:"2px 8px",fontSize:10,fontWeight:600,color:"#93c5fd"}}>KUNDE</span>
                        <h4 style={{margin:"8px 0 3px",fontSize:14,fontWeight:600}}>Preisdatei Renault.csv</h4>
                        <p style={{fontSize:11,color:"#64748b",marginBottom:12}}>Artikel, Listenpreis, Kundenpreis</p>
                        <button onClick={()=>dl(result.defCSV,"Preisdatei Renault.csv")} style={{
                          background:"linear-gradient(135deg,#3b82f6,#2563eb)",color:"white",border:"none",borderRadius:7,
                          padding:"9px 14px",fontSize:13,fontWeight:600,cursor:"pointer",width:"100%"}}>‚¨áÔ∏è Herunterladen</button>
                      </div>
                      <div style={{background:"#1e293b",borderRadius:10,padding:18,border:"1px solid #334155"}}>
                        <span style={{background:"#7c2d12",borderRadius:5,padding:"2px 8px",fontSize:10,fontWeight:600,color:"#fdba74"}}>CSS</span>
                        <h4 style={{margin:"8px 0 3px",fontSize:14,fontWeight:600}}>Preisliste css Renault.csv</h4>
                        <p style={{fontSize:11,color:"#64748b",marginBottom:12}}>Inkl. EK, Rabatte, Beschreibung, Gewicht</p>
                        <button onClick={()=>dl(result.extCSV,"Preisliste css Renault.csv")} style={{
                          background:"linear-gradient(135deg,#f59e0b,#d97706)",color:"#0f172a",border:"none",borderRadius:7,
                          padding:"9px 14px",fontSize:13,fontWeight:600,cursor:"pointer",width:"100%"}}>‚¨áÔ∏è Herunterladen</button>
                      </div>
                    </div>
                  </div>
                )}
                {result && result.error && (
                  <div style={{background:"rgba(127,29,29,0.3)",border:"1px solid #991b1b",borderRadius:10,padding:16,color:"#fca5a5",fontSize:14}}>
                    <strong>Fehler:</strong> {result.error}
                  </div>
                )}
              </div>
            )}

            {/* ADMIN */}
            {tab==="admin" && (
              <div style={{animation:"fadeIn 0.3s ease"}}>
                <div style={{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:14,flexWrap:"wrap",gap:10}}>
                  <div>
                    <h2 style={{fontSize:18,fontWeight:700}}>Rabatte verwalten</h2>
                    <p style={{fontSize:12,color:"#64748b",marginTop:2}}>
                      {cnt} Familien ‚Ä¢ Aktiv: <strong style={{color:"#f59e0b"}}>{activeYear}</strong>
                      {msg && <span style={{marginLeft:10,color:"#10b981",fontWeight:600}}>{msg}</span>}
                    </p>
                  </div>
                  <div style={{display:"flex",gap:6,flexWrap:"wrap"}}>
                    <button onClick={()=>{dl(JSON.stringify(state,null,2),"rabatte-backup.json");}}
                      style={{background:"#1e293b",color:"#94a3b8",border:"1px solid #334155",borderRadius:7,padding:"6px 12px",fontSize:11,cursor:"pointer"}}>üíæ Backup</button>
                    <label style={{background:"#1e293b",color:"#94a3b8",border:"1px solid #334155",borderRadius:7,padding:"6px 12px",fontSize:11,cursor:"pointer"}}>
                      üìÇ Import
                      <input type="file" accept=".json" style={{display:"none"}} onChange={async e=>{
                        const f=e.target.files[0]; if(!f) return;
                        try{upd(JSON.parse(await f.text()));}catch(err){alert("Ung√ºltige Datei");}
                      }}/>
                    </label>
                    <button onClick={()=>upd(mkDefault())}
                      style={{background:"#7f1d1d",color:"#fca5a5",border:"1px solid #991b1b",borderRadius:7,padding:"6px 12px",fontSize:11,cursor:"pointer"}}>üîÑ Reset</button>
                  </div>
                </div>

                <div style={{display:"flex",gap:10,marginBottom:12,flexWrap:"wrap"}}>
                  <div style={{position:"relative",flex:"1 1 220px"}}>
                    <span style={{position:"absolute",left:9,top:"50%",transform:"translateY(-50%)",fontSize:14}}>üîç</span>
                    <input value={search} onChange={e=>setSearch(e.target.value)} placeholder="Familie suchen..."
                      style={{background:"rgba(30,41,59,0.6)",border:"1px solid #334155",borderRadius:7,padding:"7px 7px 7px 32px",color:"#e2e8f0",fontSize:12,width:"100%"}}/>
                  </div>
                  <div style={{display:"flex",gap:6,alignItems:"center"}}>
                    <input value={nCode} onChange={e=>setNCode(e.target.value)} placeholder="Neuer Code" onKeyDown={e=>e.key==="Enter"&&addFam()}
                      style={{background:"#0f172a",border:"1px solid #334155",borderRadius:7,padding:"7px 10px",color:"#e2e8f0",fontSize:12,width:120}}/>
                    <button onClick={addFam} style={{background:"linear-gradient(135deg,#10b981,#059669)",color:"white",border:"none",borderRadius:7,padding:"7px 14px",fontSize:12,fontWeight:600,cursor:"pointer",whiteSpace:"nowrap"}}>+ Neu</button>
                  </div>
                </div>

                <div style={{background:"rgba(30,41,59,0.4)",borderRadius:6,padding:"6px 14px",marginBottom:10,display:"flex",gap:16,flexWrap:"wrap",fontSize:11,color:"#64748b",alignItems:"center"}}>
                  <span>üí° Klicke auf Werte zum √Ñndern</span>
                  <span style={{color:"#334155"}}>|</span>
                  {YEARS.map(y=><span key={y} style={{color:yC[y]}}>‚óè {y}</span>)}
                  <span style={{color:"#f472b6"}}>‚óè Sonder</span>
                  <span style={{color:"#334155"}}>|</span>
                  <span>VK = Kundenrabatt ‚Ä¢ EK = Eigenrabatt</span>
                  <span style={{color:"#334155"}}>|</span>
                  <span>‚≠ê = Aktives Jahr</span>
                </div>

                <div style={{background:"rgba(30,41,59,0.6)",border:"1px solid #334155",borderRadius:10,overflow:"hidden"}}>
                  <div style={{overflowX:"auto",maxHeight:"65vh",overflowY:"auto"}}>
                    <table style={{width:"100%",borderCollapse:"collapse",fontSize:12,minWidth:1050}}>
                      <thead>
                        <tr style={{background:"#0f172a",position:"sticky",top:0,zIndex:20}}>
                          <th rowSpan="2" style={{padding:"7px 10px",textAlign:"left",borderBottom:"1px solid #334155",color:"#64748b",fontSize:10,textTransform:"uppercase",letterSpacing:0.8,verticalAlign:"bottom",position:"sticky",left:0,background:"#0f172a",zIndex:21}}>Code</th>
                          <th rowSpan="2" style={{padding:"7px 6px",textAlign:"center",borderBottom:"1px solid #334155",color:"#64748b",fontSize:10,verticalAlign:"bottom"}}>Typ</th>
                          {YEARS.map(y=>(
                            <th key={y} colSpan="2" style={{padding:"5px 6px",textAlign:"center",borderBottom:"1px solid #1e293b",
                              color:yC[y],fontSize:11,fontWeight:700,
                              background:activeYear===y?"rgba(245,158,11,0.08)":"transparent"}}>
                              {y} {activeYear===y&&"‚≠ê"}
                            </th>
                          ))}
                          <th colSpan="3" style={{padding:"5px 6px",textAlign:"center",borderBottom:"1px solid #1e293b",color:"#f472b6",fontSize:11,fontWeight:700,background:"rgba(244,114,182,0.04)"}}>
                            Sonderrabatte
                          </th>
                          <th rowSpan="2" style={{padding:"7px 6px",textAlign:"center",borderBottom:"1px solid #334155",color:"#64748b",fontSize:10,verticalAlign:"bottom",width:48}}>Marge</th>
                          <th rowSpan="2" style={{padding:"7px 6px",textAlign:"center",borderBottom:"1px solid #334155",color:"#64748b",fontSize:10,verticalAlign:"bottom",width:40}}>Quelle</th>
                          <th rowSpan="2" style={{width:32,borderBottom:"1px solid #334155"}}/>
                        </tr>
                        <tr style={{background:"#0f172a",position:"sticky",top:0,zIndex:19}}>
                          {YEARS.map(y=>(
                            <React.Fragment key={y}>
                              <th style={{padding:"3px 6px",textAlign:"right",borderBottom:"1px solid #334155",color:yC[y],fontSize:9,fontWeight:600,opacity:0.7,
                                background:activeYear===y?"rgba(245,158,11,0.08)":"transparent"}}>VK%</th>
                              <th style={{padding:"3px 6px",textAlign:"right",borderBottom:"1px solid #334155",color:yC[y],fontSize:9,fontWeight:600,opacity:0.7,
                                background:activeYear===y?"rgba(245,158,11,0.08)":"transparent"}}>EK%</th>
                            </React.Fragment>
                          ))}
                          <th style={{padding:"3px 6px",textAlign:"right",borderBottom:"1px solid #334155",color:"#f472b6",fontSize:9,fontWeight:600,opacity:0.7,background:"rgba(244,114,182,0.04)"}}>VK%</th>
                          <th style={{padding:"3px 6px",textAlign:"right",borderBottom:"1px solid #334155",color:"#f472b6",fontSize:9,fontWeight:600,opacity:0.7,background:"rgba(244,114,182,0.04)"}}>EK%</th>
                          <th style={{padding:"3px 6px",textAlign:"center",borderBottom:"1px solid #334155",color:"#f472b6",fontSize:9,fontWeight:600,opacity:0.7,background:"rgba(244,114,182,0.04)"}}>Aktiv</th>
                        </tr>
                      </thead>
                      <tbody>
                        {filtered.sort(([a],[b])=>a.localeCompare(b)).map(([code,fam],i)=>{
                          const suf = code.slice(-1);
                          const tc = tC[suf]||{bg:"#334155",t:"#94a3b8"};
                          const disc = getDisc(fam, activeYear);
                          const marge = disc ? (disc.ek-disc.vk).toFixed(2) : null;

                          return (
                            <tr key={code} style={{borderBottom:"1px solid #1e293b",background:i%2===0?"transparent":"rgba(15,23,42,0.3)"}}>
                              <td style={{padding:"7px 10px",fontWeight:600,fontFamily:"monospace",fontSize:13,position:"sticky",left:0,background:i%2===0?"#1e293b":"#172033",zIndex:5}}>{code}</td>
                              <td style={{textAlign:"center",padding:"7px 4px"}}>
                                <span style={{background:tc.bg,color:tc.t,borderRadius:4,padding:"1px 7px",fontSize:10,fontWeight:600}}>{suf}</span>
                              </td>
                              {YEARS.map(y=>(
                                <React.Fragment key={y}>
                                  <td style={{textAlign:"right",padding:"5px 6px",background:activeYear===y?"rgba(245,158,11,0.04)":"transparent"}}>
                                    {renderE(code,y,"vk",fam[y]?.vk,yC[y])}
                                  </td>
                                  <td style={{textAlign:"right",padding:"5px 6px",background:activeYear===y?"rgba(245,158,11,0.04)":"transparent"}}>
                                    {renderE(code,y,"ek",fam[y]?.ek,yC[y])}
                                  </td>
                                </React.Fragment>
                              ))}
                              <td style={{textAlign:"right",padding:"5px 6px",background:"rgba(244,114,182,0.04)"}}>
                                {renderE(code,"sonder","vk",fam.sonder?.vk,"#f472b6")}
                              </td>
                              <td style={{textAlign:"right",padding:"5px 6px",background:"rgba(244,114,182,0.04)"}}>
                                {renderE(code,"sonder","ek",fam.sonder?.ek,"#f472b6")}
                              </td>
                              <td style={{textAlign:"center",padding:"5px 6px",background:"rgba(244,114,182,0.04)"}}>
                                <Toggle on={fam.sonder?.active||false} onToggle={()=>togSonder(code)}/>
                              </td>
                              <td style={{textAlign:"right",padding:"5px 6px",fontSize:11,fontVariantNumeric:"tabular-nums",
                                color:marge!==null?(parseFloat(marge)>=0?"#10b981":"#ef4444"):"#334155"}}>
                                {marge!==null?(parseFloat(marge)>0?"+":"")+marge:"‚Äî"}
                              </td>
                              <td style={{textAlign:"center",padding:"5px 4px"}}>
                                {disc ? (
                                  <span style={{fontSize:9,padding:"1px 6px",borderRadius:4,fontWeight:600,
                                    background:disc.src==="Sonder"?"rgba(244,114,182,0.15)":"rgba(245,158,11,0.1)",
                                    color:disc.src==="Sonder"?"#f472b6":"#f59e0b"}}>{disc.src}</span>
                                ) : <span style={{color:"#334155",fontSize:10}}>‚Äî</span>}
                              </td>
                              <td style={{textAlign:"center",padding:"5px 3px"}}>
                                <button onClick={()=>delFam(code)}
                                  style={{background:"transparent",border:"none",color:"#475569",cursor:"pointer",padding:1,fontSize:12}}
                                  onMouseEnter={e=>e.target.style.color="#ef4444"} onMouseLeave={e=>e.target.style.color="#475569"}>üóëÔ∏è</button>
                              </td>
                            </tr>
                          );
                        })}
                      </tbody>
                    </table>
                  </div>
                  {filtered.length===0 && <div style={{textAlign:"center",padding:32,color:"#475569"}}>Keine Familien gefunden</div>}
                </div>
                <p style={{fontSize:10,color:"#475569",marginTop:8,textAlign:"center"}}>
                  ‚≠ê = aktives Kalkulationsjahr ‚Ä¢ Sonderrabatte √ºberschreiben Jahresrabatte wenn aktiviert ‚Ä¢ "‚Äî" = kein Wert hinterlegt, klicken zum Eintragen
                </p>
              </div>
            )}
          </div>
        </div>
      );
    }

    // Login Component
    function Login({ onLogin }) {
      const [user, setUser] = useState("");
      const [pass, setPass] = useState("");
      const [error, setError] = useState("");

      const handleSubmit = (e) => {
        e.preventDefault();
        if (user === AUTH_USER && pass === AUTH_PASS) {
          sessionStorage.setItem(AUTH_KEY, "1");
          onLogin();
        } else {
          setError("Ung√ºltige Zugangsdaten");
          setTimeout(() => setError(""), 3000);
        }
      };

      return (
        <div style={{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",padding:20}}>
          <div style={{background:"rgba(30,41,59,0.8)",border:"1px solid #334155",borderRadius:16,padding:40,width:"100%",maxWidth:380,animation:"fadeIn 0.4s"}}>
            <div style={{textAlign:"center",marginBottom:30}}>
              <div style={{background:"linear-gradient(135deg,#f59e0b,#d97706)",borderRadius:14,width:56,height:56,display:"flex",alignItems:"center",justifyContent:"center",fontWeight:800,fontSize:24,color:"#0f172a",margin:"0 auto 16px"}}>R</div>
              <h1 style={{fontSize:20,fontWeight:700,color:"#f8fafc",marginBottom:6}}>Renault Preislisten-Tool</h1>
              <p style={{fontSize:13,color:"#64748b"}}>Bitte melden Sie sich an</p>
            </div>
            
            <form onSubmit={handleSubmit}>
              <div style={{marginBottom:16}}>
                <label style={{display:"block",fontSize:12,color:"#94a3b8",marginBottom:6}}>Benutzername</label>
                <input type="text" value={user} onChange={e=>setUser(e.target.value)}
                  style={{width:"100%",background:"#0f172a",border:"1px solid #334155",borderRadius:8,padding:"12px 14px",color:"#e2e8f0",fontSize:14}}
                  placeholder="Benutzername eingeben" autoFocus />
              </div>
              <div style={{marginBottom:24}}>
                <label style={{display:"block",fontSize:12,color:"#94a3b8",marginBottom:6}}>Passwort</label>
                <input type="password" value={pass} onChange={e=>setPass(e.target.value)}
                  style={{width:"100%",background:"#0f172a",border:"1px solid #334155",borderRadius:8,padding:"12px 14px",color:"#e2e8f0",fontSize:14}}
                  placeholder="Passwort eingeben" />
              </div>
              
              {error && (
                <div style={{background:"rgba(127,29,29,0.3)",border:"1px solid #991b1b",borderRadius:8,padding:"10px 14px",marginBottom:16,color:"#fca5a5",fontSize:13,textAlign:"center"}}>
                  {error}
                </div>
              )}
              
              <button type="submit" style={{
                width:"100%",background:"linear-gradient(135deg,#f59e0b,#d97706)",color:"#0f172a",border:"none",
                borderRadius:8,padding:"12px 14px",fontSize:14,fontWeight:600,cursor:"pointer"
              }}>Anmelden</button>
            </form>
          </div>
        </div>
      );
    }

    // Main Wrapper
    function Root() {
      const [auth, setAuth] = useState(() => sessionStorage.getItem(AUTH_KEY) === "1");
      
      if (!auth) return <Login onLogin={() => setAuth(true)} />;
      return <App />;
    }

    ReactDOM.createRoot(document.getElementById("root")).render(<Root />);
  </script>
</body>
</html>
